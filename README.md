# Danbooru Tag Copier

## 概要

これは、画像掲示板サイト [Danbooru](https://danbooru.donmai.us/) の投稿ページでタグを効率的にコピーするためのGoogle Chrome拡張機能です。

コンテキストメニューから専用のUIを開き、タグをカテゴリ別に分類してコピーできます。さらに、**Gemini APIを利用して「一般タグ」を詳細な属性（身体、服装、構図など）に自動で分類する**、高度な機能を備えています。


<img width="398" height="645" alt="Image" src="https://github.com/user-attachments/assets/5b729d14-0148-4d08-89a8-db834a17cbdc" />

## 主な機能

- **カテゴリ別タグ分類**:
  投稿に含まれるタグを「Copyrights」「Characters」「Artist」「General」「Meta」の5つの主要カテゴリに自動で分類し、表示します。

- **AIによる高度な属性分類**:
  「General Tags」セクションのボタン一つで、Gemini APIがタグを解析。「身体」「服装」「構図」「背景」「その他」といった、より詳細で実用的な属性に再分類します。

- **直感的なUIと個別コピー**:
  各カテゴリや属性ごとに専用の「Copy」ボタンが用意されており、必要なタグのグループだけをワンクリックでクリップボードにコピーできます。

- **進捗の可視化**:
  AIによる分類中は、プログレスバーとステータスメッセージが表示されるため、処理の進行状況をリアルタイムで把握できます。

- **簡単なAPIキー設定**:
  AI機能を利用するためのAPIキーは、専用のオプションページから簡単に設定・保存できます。

## インストールと設定

この拡張機能は2つのステップでセットアップが完了します。

### Step 1: 拡張機能のインストール

1.  **ファイルの準備**:
    この拡張機能の全ファイル（`manifest.json`, `background.js`など）を、PC上の任意の場所に一つのフォルダ（例: `danbooru-tag-copier`）を作成して保存します。

2.  **Chrome拡張機能ページを開く**:
    Chromeブラウザのアドレスバーに `chrome://extensions` と入力し、Enterキーを押します。

3.  **デベロッパーモードを有効にする**:
    拡張機能管理ページの右上にある「**デベロッパーモード**」のスイッチをオンにします。

4.  **拡張機能を読み込む**:
    左上に表示される「**パッケージ化されていない拡張機能を読み込む**」ボタンをクリックし、手順1で作成したフォルダを選択します。一覧に「Danbooru Tag Copier」が表示されればインストールは完了です。

### Step 2: APIキーの設定（AI機能を利用する場合）

AIによる属性分類機能を使用するには、GoogleのGemini APIキーが必要です。

1.  **APIキーの取得**:
    [Google AI Studio](https://aistudio.google.com/app/apikey)にアクセスし、ご自身のGoogleアカウントでログインしてAPIキーを作成（または取得）します。

2.  **拡張機能への設定**:
    -   Chromeのツールバーにある**本拡張機能のアイコン（パズルピースの隣など）をクリック**すると、設定ページが開きます。
    -   取得したAPIキーを入力フィールドに貼り付け、「保存」ボタンをクリックします。

これで全ての機能が利用可能になります。

## 使い方

1.  Danbooruの投稿ページ（例: `https://danbooru.donmai.us/posts/123456`）にアクセスします。
2.  ページ上の任意の場所（イラスト画像の上でも可）で右クリックします。
3.  コンテキストメニューから「**Danbooruタグを分類してコピー**」を選択します。
4.  画面に専用のUI（モーダルウィンドウ）が表示されます。
    -   **通常のコピー**: 各カテゴリの横にある「Copy」ボタンをクリックすると、そのカテゴリのタグがクリップボードにコピーされます。
    -   **AIによる分類**: 「General Tags」セクションにある「**AIで属性分類**」ボタンをクリックします。プログレスバーが表示された後、一般タグが詳細な属性に分類されて表示されます。分類された各属性の横にある「Copy」ボタンで、それぞれコピーできます。

## ファイル構成

-   `manifest.json`: 拡張機能の基本的な情報、権限、動作設定を定義する設計図です。
-   `background.js`: コンテキストメニューの作成や、Gemini APIとの通信を仲介するバックグラウンドスクリプトです。
-   `content.js`: Danbooruのページに挿入され、タグの収集やUIの生成・操作を担当するメインスクリプトです。
-   `main.css`: UIの見た目を定義するスタイルシートです。
-   `options.html`: APIキー設定ページのHTMLファイルです。
-   `options.js`: 設定ページのロジックを記述したスクリプトです。
-   `icons/`: 拡張機能のアイコン画像が格納されています。
-   `README.md`: このファイルです。拡張機能の説明書です。

## 注意事項

-   この拡張機能はDanbooruのサイト構造に依存しています。Danbooru側のアップデートによりHTML構造が変更された場合、正常に動作しなくなる可能性があります。
-   AI分類機能はGoogle Gemini APIを使用します。APIの利用規約や料金体系にご注意ください（多くの場合、個人的な利用の範囲では無料枠で十分に賄えます）。
-   LLMの「思考」が悪さしてAIの出力を受け取れない場合があります。その時は再度分類を試してください。

## ライセンス

このプロジェクトは [MIT License](https://opensource.org/licenses/MIT) の下で公開されています。
